var ChilLogo=function(window){function startLogoCanvas(){logoContext=logoCanvas.getContext("2d"),resize(),createColorQueue(),shapeForegroundColor=colorQueue[0][0].clone(),shapeBackgroundColor=colorQueue[0][1].clone(),shapeForeground=createShape(ORIGINAL_WIDTH*options.foregroundScaleX,ORIGINAL_HEIGHT*options.foregroundScaleY,.2),shapeBackground=createShape(ORIGINAL_WIDTH*options.backgroundScaleX,ORIGINAL_HEIGHT*options.backgroundScaleY,3.3),$(logoCanvas).show(),wordImage=$("<img>").load(function(){updateInterval=setInterval(loop,1e3/options.framerate)}),wordImage.attr("src",options.wordImageURL),options.inputs.map(function(o){o.initialize()})}function startShadowCanvas(){shadowContext=shadowCanvas.getContext("2d"),$(shadowCanvas).css("display","block"),resize()}function startFallback(){$("img",container).show().mouseover(function(){var o=options.fallbackImages.shift();$(this).attr("src",o),options.fallbackImages.push(o)})}function enableDebugging(){function createDebugProperty(o,e){return"	 "+o+": "+(e||"")+options[o]+(e||"")+",\n"}options.debug=!0;var configureScript="ChilLogo.initialize({\n";configureScript+=createDebugProperty("framerate"),configureScript+="	\n",configureScript+=createDebugProperty("width"),configureScript+=createDebugProperty("height"),configureScript+="	\n",configureScript+=createDebugProperty("colorSpeedFactor"),configureScript+=createDebugProperty("morphSpeedFactor"),configureScript+=createDebugProperty("morphStrengthFactor"),configureScript+=createDebugProperty("morphBaseSpeedFactor"),configureScript+=createDebugProperty("introSpeedFactor"),configureScript+=createDebugProperty("outroSpeedFactor"),configureScript+=createDebugProperty("normalOffsetFactor"),configureScript+="	\n",configureScript+=createDebugProperty("maxShapeRotation"),configureScript+="	\n",configureScript+=createDebugProperty("wordOffsetX"),configureScript+=createDebugProperty("wordOffsetY"),configureScript+=createDebugProperty("wordScale"),configureScript+="	\n",configureScript+=createDebugProperty("foregroundScaleX"),configureScript+=createDebugProperty("foregroundScaleY"),configureScript+=createDebugProperty("backgroundScaleX"),configureScript+=createDebugProperty("backgroundScaleY"),configureScript+="	\n",configureScript+=createDebugProperty("shadowAlpha"),configureScript+="	\n",configureScript+=createDebugProperty("shapeQuality"),configureScript+="	\n",configureScript+=createDebugProperty("containerID",'"'),configureScript+=createDebugProperty("logoCanvasID",'"'),configureScript+=createDebugProperty("shadowCanvasID",'"'),configureScript+="	\n",configureScript+="		colors: [\n",configureScript+="			 // Foreground: 							 Background: \n";for(var i=0;i<options.colors.length;i++){var ca=options.colors[i][0],cb=options.colors[i][0];configureScript+="			 [ new ChilLogo.util.Color( "+ca.r+", "+ca.g+", "+ca.r+" ), 	 new ChilLogo.util.Color( "+ca.r+", "+ca.g+", "+ca.r+" ) ],\n"}configureScript+="		 ]\n",configureScript+="});",$("#debug-panel textarea").text(configureScript),$("#debug-panel .run").click(function(event){event.preventDefault(),eval($("#debug-panel textarea").val())}),$("#debug-panel .save").click(function(o){o.preventDefault(),window.open(logoCanvas.toDataURL("image/png"))})}function createColorQueue(){function o(){return.5-Math.random()}colorQueue=options.colors.concat(),colorQueue.sort(o)}function createShape(o,e,t){for(var r={offset:{x:0,y:0,tx:Math.cos(t)*SHAPE_OFFSET,ty:Math.sin(t)*SHAPE_OFFSET,angle:t},radiusx:o,radiusy:e,rotation:-(.5*options.maxShapeRotation)+Math.random()*options.maxShapeRotation,points:[]},a=options.shapeQuality;--a;){var n={normal:createShapeNormal(r,a,options.shapeQuality),normalTarget:{x:0,y:0},offset:{x:(-MORPH_RANGE+Math.random()*MORPH_RANGE2)*scale,y:(-MORPH_RANGE+Math.random()*MORPH_RANGE2)*scale},target:{x:0,y:0},velocity:{x:0,y:0},speed:.01+.015*Math.random(),state:INTRO_STATE,x:0,y:0};n.target.x=n.normal.x,n.target.y=n.normal.y,n.normalTarget.x=n.normal.x,n.normalTarget.y=n.normal.y,r.points.push(n)}return r}function createShapeNormal(o,e,t){var r=1,a=1,n=.1*options.normalOffsetFactor,i=.2*options.normalOffsetFactor;Math.random()>.3&&(r-=n+Math.random()*n,1==shapeTemplate?e%2==0?a+=i+Math.random()*i:a-=i+Math.random()*i:2==shapeTemplate?e%2==0?a-=i+Math.random()*i:a+=i+Math.random()*i:Math.random()>.5?a-=i+Math.random()*i:a+=i+Math.random()*i);var p=e/t*Math.PI*2;return{x:Math.cos(p)*o.radiusx*r*scale,y:Math.sin(p)*o.radiusy*a*scale}}function centerOfShape(o){return{x:.5*options.width+o.offset.x*scale,y:.5*options.height+o.offset.y*scale}}function resize(o,e){options.width=o||options.width,options.height=e||options.height,scale=Math.min(options.width/ORIGINAL_WIDTH,options.height/ORIGINAL_HEIGHT),logoCanvas&&(logoCanvas.width=options.width,logoCanvas.height=options.height),shadowCanvas&&(shadowCanvas.width=options.width,shadowCanvas.height=options.height*SHADOW_SCALE_Y)}function loop(){tilt.current+=.2*(tilt.target-tilt.current),turboColorSpeedFactor+=(1-turboColorSpeedFactor)*TURBO_DECAY,turboMorphSpeedFactor+=(1-turboMorphSpeedFactor)*TURBO_DECAY,turboMorphStrengthFactor+=(1-turboMorphStrengthFactor)*TURBO_DECAY,updateColor(),updatePerformance(),updateShape(shapeForeground),updateShape(shapeBackground),renderLogo(),renderWord(),renderShadow()}function updatePerformance(){var o=(new Date).getTime();performance.frameCount++,o>performance.lastSecond+1e3&&(performance.fps=Math.max(Math.min(Math.round(1e3*performance.frameCount/(o-performance.lastSecond)),options.framerate),1),performance.factor=Math.min(ORIGINAL_FRAMERATE/options.framerate,1)+(1-performance.fps/ORIGINAL_FRAMERATE),performance.lastSecond=o,performance.frameCount=0)}function componentToHex(o){var e=o.toString(16);return 1==e.length?"0"+e:e}function rgbToHex(o,e,t){return"#"+componentToHex(o)+componentToHex(e)+componentToHex(t)}function updateColor(){var o=colorQueue[0][0],e=colorQueue[0][1];targetColor!=rgbToHex(o.r,o.g,o.b)&&(targetColor=rgbToHex(o.r,o.g,o.b),$("#geek").animate({color:targetColor},.015*options.colorSpeedFactor*performance.factor*turboColorSpeedFactor*3e5),$("#geek2").animate({color:targetColor},.015*options.colorSpeedFactor*performance.factor*turboColorSpeedFactor*3e5)),shapeForegroundColor.approach(o,.015*options.colorSpeedFactor*performance.factor*turboColorSpeedFactor),shapeBackgroundColor.approach(e,.015*options.colorSpeedFactor*performance.factor*turboColorSpeedFactor);var t=shapeForegroundColor.isWithinRangeOf(.1*options.colorSpeedFactor*turboColorSpeedFactor,o),r=shapeBackgroundColor.isWithinRangeOf(.1*options.colorSpeedFactor*turboColorSpeedFactor,e);t&&r&&(colorQueue.shift(),colorQueue[0]||createColorQueue()),alpha=visible?Math.min(alpha+.01*options.introSpeedFactor,1):Math.max(alpha-.01*options.outroSpeedFactor,0)}function updateShape(o){o.offset.x+=.1*(o.offset.tx-o.offset.x),o.offset.y+=.1*(o.offset.ty-o.offset.y);for(var e=0,t=o.points.length;t>e;e++){p1=ChilLogo.util.getLoopedArrayElement(o.points,e),shapeBounds.left=Math.min(shapeBounds.left,p1.x),shapeBounds.right=Math.max(shapeBounds.right,p1.x);var r=options.morphSpeedFactor;switch(p1.state){case INTRO_STATE:r=options.introSpeedFactor;break;case OUTRO_STATE:r=options.outroSpeedFactor}p1.normal.x+=.01*(p1.normalTarget.x-p1.normal.x),p1.normal.y+=.01*(p1.normalTarget.y-p1.normal.y),p1.x+=(p1.target.x-p1.x)*p1.speed*r*performance.factor*turboMorphSpeedFactor,p1.y+=(p1.target.y-p1.y)*p1.speed*r*performance.factor*turboMorphSpeedFactor,p1.x+=p1.velocity.x,p1.y+=p1.velocity.y,p1.velocity.x*=FRICTION,p1.velocity.y*=FRICTION,ChilLogo.util.distanceBetween(p1,p1.normal)>MORPH_RANGE2&&(p1.velocity.x*=Math.pow(FRICTION,16),p1.velocity.y*=Math.pow(FRICTION,16)),Math.abs(p1.x-p1.target.x)<1&&p1.state!==OUTRO_STATE&&(p1.target.x=p1.normal.x,p1.target.x+=(-MORPH_RANGE+Math.random()*MORPH_RANGE2)*options.morphStrengthFactor*turboMorphStrengthFactor*scale,p1.state=MORPH_STATE),Math.abs(p1.y-p1.target.y)<1&&p1.state!==OUTRO_STATE&&(p1.target.y=p1.normal.y,p1.target.y+=(-MORPH_RANGE+Math.random()*MORPH_RANGE2)*options.morphStrengthFactor*turboMorphStrengthFactor*scale,p1.state=MORPH_STATE),Math.abs(p1.normal.x-p1.normalTarget.x)<1&&Math.abs(p1.normal.y-p1.normalTarget.y)<1&&(p1.normalTarget=createShapeNormal(o,o.points.length-e,options.shapeQuality))}}function renderShadow(){if(shadowCanvas&&shadowContext){var o=shadowCanvas.width,e=shadowCanvas.height,t=1+Math.abs(shapeBounds.right-shapeBounds.left)/options.width,r=.2,a=(Math.abs(shapeBounds.left)-Math.abs(shapeBounds.right))/2;shadowContext.clearRect(0,0,o,e),shadowContext.save(),shadowContext.globalAlpha=alpha,shadowContext.translate(-(o*(t-1)/2)-a,-(e*(r-1)/2)),shadowContext.scale(t,r);var n=shadowContext.createRadialGradient(.5*o,.5*e,0,.5*o,.5*e,e/2);n.addColorStop(.3,"rgba(0, 0, 0, "+options.shadowAlpha+")"),n.addColorStop(1,"rgba(0, 0, 0, 0.0)"),shadowContext.fillStyle=n,shadowContext.fillRect(0,0,o,e),shadowContext.restore()}}function renderLogo(){shapeBounds.left=options.width,shapeBounds.right=0,logoContext.clearRect(0,0,options.width,options.height),logoContext.save(),logoContext.globalAlpha=alpha,logoContext.save(),(0!==tilt.current||tilt.target!==tilt.current)&&(logoContext.translate(Math.round(.5*options.width),Math.round(.5*options.height)),logoContext.rotate(tilt.current),logoContext.translate(-Math.round(.5*options.width),-Math.round(.5*options.height))),renderShape(shapeForeground,shapeForegroundColor),logoContext.save(),logoContext.globalCompositeOperation="source-atop",renderShape(shapeBackground,new ChilLogo.util.Color(0,0,0,.5)),logoContext.globalCompositeOperation="destination-over",renderShape(shapeBackground,shapeBackgroundColor),logoContext.restore(),logoContext.restore(),logoContext.restore()}function renderWord(){logoContext.save(),logoContext.globalAlpha=alpha;var o=ORIGINAL_WORD_WIDTH*scale*options.wordScale,e=ORIGINAL_WORD_HEIGHT*scale*options.wordScale,t=Math.round(.5*(options.width-o))+options.wordOffsetX*scale,r=Math.round(.5*(options.height-e))+options.wordOffsetY*scale;logoContext.drawImage(wordImage.get(0),t,r,o,e),logoContext.restore()}function renderShape(o,e){var t=centerOfShape(o);logoContext.save(),logoContext.translate(t.x,t.y),logoContext.rotate(o.rotation),logoContext.beginPath();var r=ChilLogo.util.getLoopedArrayElement(o.points,-1),a=ChilLogo.util.getLoopedArrayElement(o.points,0);logoContext.moveTo(r.x+(a.x-r.x)/2,r.y+(a.y-r.y)/2);for(var n=0,i=o.points.length;i>=n;n++)r=ChilLogo.util.getLoopedArrayElement(o.points,n),a=ChilLogo.util.getLoopedArrayElement(o.points,n+1),logoContext.quadraticCurveTo(r.x,r.y,r.x+(a.x-r.x)/2,r.y+(a.y-r.y)/2);logoContext.fillStyle=e.toRGBAString(),logoContext.fill(),logoContext.restore()}var INTRO_STATE=0,MORPH_STATE=1,OUTRO_STATE=2,ORIGINAL_WIDTH=160,ORIGINAL_HEIGHT=125,ORIGINAL_FRAMERATE=60,SHADOW_SCALE_Y=.5,ORIGINAL_WORD_WIDTH=144,ORIGINAL_WORD_HEIGHT=41,MORPH_RANGE=20,MORPH_RANGE2=2*MORPH_RANGE,TURBO_DECAY=.01,FRICTION=.95,SHAPE_OFFSET=10,PARALLAX_AMOUNT=10,IS_TOUCH_DEVICE=!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)),API={util:{},input:{}},document=window.document,initialized=!1,options={containerID:"chil-logo",logoCanvasID:"chil-logo-canvas",shadowCanvasID:null,wordImageURL:"/assets/themes/dwtalk/img/chil.png",wordOffsetX:-25,wordOffsetY:0,wordScale:1,framerate:IS_TOUCH_DEVICE?30:ORIGINAL_FRAMERATE,debug:!0,width:200,height:150,foregroundScaleX:.39,foregroundScaleY:.23,backgroundScaleX:.39,backgroundScaleY:.23,maxShapeRotation:.2,colorSpeedFactor:1,introSpeedFactor:3,outroSpeedFactor:3,morphSpeedFactor:1,morphBaseSpeedFactor:.2,morphStrengthFactor:.8,normalOffsetFactor:1.5,shadowAlpha:.1,shapeQuality:9,colors:[],inputs:[],fallbackImages:[]},container=null,logoCanvas=null,logoContext=null,shadowCanvas=null,shadowContext=null,wordImage=null,updateInterval=-1,scale=1,alpha=0,turboMorphStrengthFactor=1,turboMorphSpeedFactor=1,turboColorSpeedFactor=1,visible=!0,tilt={current:0,target:0},shapeForeground=null,shapeBackground=null,shapeForegroundColor=null,shapeBackgroundColor=null,shapeBounds={left:0,right:0},colorQueue=[],colorTween=0,performance={fps:options.framerate,lastSecond:(new Date).getTime(),frameCount:0,factor:1};API.initialize=function(o){clearInterval(updateInterval),ChilLogo.util.extendObject(options,o),container=$("#"+options.containerID),logoCanvas=$("#"+options.logoCanvasID).get(0),shadowCanvas=$("#"+options.shadowCanvasID).get(0),logoCanvas&&logoCanvas.getContext?(startLogoCanvas(),shadowCanvas&&shadowCanvas.getContext&&startShadowCanvas()):startFallback(),options.debug&&enableDebugging(),initialized&&API.configure(o),initialized=!0},API.configure=function(o){ChilLogo.util.extendObject(options,o),resize(),logoContext&&(createColorQueue(),shapeForegroundColor=colorQueue[0][0].clone(),shapeBackgroundColor=colorQueue[0][1].clone(),shapeForeground=createShape(ORIGINAL_WIDTH*options.foregroundScaleX,ORIGINAL_HEIGHT*options.foregroundScaleY,.2),shapeBackground=createShape(ORIGINAL_WIDTH*options.backgroundScaleX,ORIGINAL_HEIGHT*options.backgroundScaleY,3.3),alpha=0,API.show())},API.getOptions=function(){return options},API.getScale=function(){return scale},API.applyImpulse=function(o,e,t,r){function a(a){for(var n=centerOfShape(a),i={x:o-n.x,y:e-n.y},p=0,c=a.points.length;c>p;p++){var s=a.points[p],l=ChilLogo.util.distanceBetween(i,s);if(r>l){var u=1-l/r;s.velocity.x+=(s.x-i.x)/options.width*t*u,s.velocity.y+=(s.y-i.y)/options.height*t*u}}}a(shapeForeground),a(shapeBackground)},API.applyForce=function(o,e,t,r,a){function n(n){for(var i=centerOfShape(n),p={x:o-i.x,y:e-i.y},c=0,s=n.points.length;s>c;c++){var l=n.points[c],u=ChilLogo.util.distanceBetween(p,l);if(a>u){var g=1-u/a;l.velocity.x+=t*g*scale,l.velocity.y+=r*g*scale}}}n(shapeForeground),n(shapeBackground)},API.applyParallax=function(o,e,t,r){shapeForeground.offset.tx=Math.cos(shapeForeground.offset.angle)*PARALLAX_AMOUNT+o,shapeForeground.offset.ty=Math.sin(shapeForeground.offset.angle)*PARALLAX_AMOUNT+e,shapeBackground.offset.tx=Math.cos(shapeBackground.offset.angle)*PARALLAX_AMOUNT+t,shapeBackground.offset.ty=Math.sin(shapeBackground.offset.angle)*PARALLAX_AMOUNT+r},API.applyTilt=function(o){tilt.target=o},API.applyTurbo=function(o,e,t){turboMorphStrengthFactor=o,turboMorphSpeedFactor=e,turboColorSpeedFactor=t},API.changeColor=function(){colorQueue.shift(),colorQueue[0]||createColorQueue()},API.show=function(){visible=!0;var o=shapeForeground.points.concat(shapeBackground.points);o.map(function(o){o.state=INTRO_STATE,o.target.x=o.normal.x,o.target.y=o.normal.y})},API.hide=function(){visible=!1;var o=shapeForeground.points.concat(shapeBackground.points);o.map(function(o){o.state=OUTRO_STATE,o.target.x=0,o.target.y=0})};var shapeTemplate=1+Math.floor(3*Math.random()),targetColor="";return API}(window);